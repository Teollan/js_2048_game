!function(){function t(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function e(e){return function(e){if(Array.isArray(e))return t(e)}(e)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(e)||function(e,n){if(e){if("string"==typeof e)return t(e,void 0);var r=Object.prototype.toString.call(e).slice(8,-1);if("Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return t(e,void 0)}}(e)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var n={};function r(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var o=function(){var t;function n(t){if(!function(t,e){if(!(t instanceof e))throw TypeError("Cannot call a class as a function")}(this,n),r(this,"score",0),r(this,"playingField",[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]]),r(this,"initialState",[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]]),r(this,"status",n.const.STATUS_IDLE),t)for(var e=0;e<n.const.PLAYING_FIELD_SIZE;e++)for(var o=0;o<n.const.PLAYING_FIELD_SIZE;o++)this.initialState[e][o]=t[e][o],this.playingField[e][o]=t[e][o]}return t=[{key:"moveLeft",value:function(){if(this.getStatus()===n.const.STATUS_PLAYING){for(var t=!0,e=0;e<n.const.PLAYING_FIELD_SIZE;e++){var r=this.getRow(e),o=this.compactLine(r);this.areLinesEqual(r,o.compacted)||(t=!1,this.setRow(e,o.compacted),this.score+=o.score)}t||(this.populateRandomly(1),this.updateStatus())}}},{key:"moveRight",value:function(){if(this.getStatus()===n.const.STATUS_PLAYING){for(var t=!0,e=0;e<n.const.PLAYING_FIELD_SIZE;e++){var r=this.getRow(e),o=this.compactLine(r.reverse());this.areLinesEqual(r,o.compacted)||(t=!1,this.setRow(e,o.compacted.reverse()),this.score+=o.score)}t||(this.populateRandomly(1),this.updateStatus())}}},{key:"moveUp",value:function(){if(this.getStatus()===n.const.STATUS_PLAYING){for(var t=!0,e=0;e<n.const.PLAYING_FIELD_SIZE;e++){var r=this.getColumn(e),o=this.compactLine(r);this.areLinesEqual(r,o.compacted)||(t=!1,this.setColumn(e,o.compacted),this.score+=o.score)}t||(this.populateRandomly(1),this.updateStatus())}}},{key:"moveDown",value:function(){if(this.getStatus()===n.const.STATUS_PLAYING){for(var t=!0,e=0;e<n.const.PLAYING_FIELD_SIZE;e++){var r=this.getColumn(e),o=this.compactLine(r.reverse());this.areLinesEqual(r,o.compacted)||(t=!1,this.setColumn(e,o.compacted.reverse()),this.score+=o.score)}t||(this.populateRandomly(1),this.updateStatus())}}},{key:"getScore",value:function(){return this.score}},{key:"getState",value:function(){for(var t=Array(n.const.PLAYING_FIELD_SIZE),e=0;e<n.const.PLAYING_FIELD_SIZE;e++){t[e]=Array(n.const.PLAYING_FIELD_SIZE);for(var r=0;r<n.const.PLAYING_FIELD_SIZE;r++)t[e][r]=this.playingField[e][r]}return t}},{key:"getStatus",value:function(){return this.status}},{key:"start",value:function(){this.status=n.const.STATUS_PLAYING,this.score=0,this.populateRandomly(2)}},{key:"restart",value:function(){for(var t=0;t<n.const.PLAYING_FIELD_SIZE;t++)for(var e=0;e<n.const.PLAYING_FIELD_SIZE;e++)this.playingField[t][e]=this.initialState[t][e];this.status=n.const.STATUS_IDLE,this.score=0}},{key:"getColumn",value:function(t){for(var e=Array(n.const.PLAYING_FIELD_SIZE),r=0;r<n.const.PLAYING_FIELD_SIZE;r++)e[r]=this.playingField[r][t];return e}},{key:"setColumn",value:function(t,e){for(var r=0;r<n.const.PLAYING_FIELD_SIZE;r++)this.playingField[r][t]=e[r]}},{key:"getRow",value:function(t){for(var e=Array(n.const.PLAYING_FIELD_SIZE),r=0;r<n.const.PLAYING_FIELD_SIZE;r++)e[r]=this.playingField[t][r];return e}},{key:"setRow",value:function(t,e){for(var r=0;r<n.const.PLAYING_FIELD_SIZE;r++)this.playingField[t][r]=e[r]}},{key:"getCells",value:function(){return this.playingField.reduce(function(t,n){return e(t).concat(e(n))},[])}},{key:"getIndexedCells",value:function(){return this.getCells().map(function(t,e){var r=e%n.const.PLAYING_FIELD_SIZE;return{row:(e-r)/n.const.PLAYING_FIELD_SIZE,column:r,value:t}})}},{key:"getCell",value:function(t,e){return this.playingField[t][e]}},{key:"setCell",value:function(t,e,n){this.playingField[t][e]=n}},{key:"populateRandomly",value:function(t){for(var e=this.getIndexedCells().filter(function(t){return 0===t.value}),n=0;n<t&&0!==e.length;n++){var r=Math.floor(Math.random()*e.length),o=e[r],s=o.row,a=o.column;e.splice(r,1),this.setCell(s,a,this.generateCellValue())}}},{key:"generateCellValue",value:function(){return Math.random()>.9?4:2}},{key:"compactLine",value:function(t){var e=t.filter(function(t){return 0!==t});if(e.length<2)return this.padWithZeros(e),{compacted:e,score:0};for(var n=[],r=0,o=0;o<e.length;o++){var s=e[o];s===e[o+1]?(n.push(2*s),r+=2*s,o++):n.push(s)}return this.padWithZeros(n),{compacted:n,score:r}}},{key:"areLinesEqual",value:function(t,e){for(var r=0;r<n.const.PLAYING_FIELD_SIZE;r++)if(t[r]!==e[r])return!1;return!0}},{key:"padWithZeros",value:function(t){for(;t.length<n.const.PLAYING_FIELD_SIZE;)t.push(0);return t}},{key:"updateStatus",value:function(){var t=this.getCells();t.some(function(t){return 2048===t})?this.status=n.const.STATUS_WIN:function(t){if(t.some(function(t){return 0===t}))return!1;for(var e=0;e<n.const.PLAYING_FIELD_SIZE;e++)for(var r=0;r<n.const.PLAYING_FIELD_SIZE-1;r++)if(t[e*n.const.PLAYING_FIELD_SIZE+r]===t[e*n.const.PLAYING_FIELD_SIZE+(r+1)])return!1;for(var o=0;o<n.const.PLAYING_FIELD_SIZE-1;o++)for(var s=0;s<n.const.PLAYING_FIELD_SIZE;s++)if(t[o*n.const.PLAYING_FIELD_SIZE+s]===t[(o+1)*n.const.PLAYING_FIELD_SIZE+s])return!1;return!0}(t)&&(this.status=n.const.STATUS_LOSE)}}],function(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}(n.prototype,t),n}();r(o,"const",Object.freeze({PLAYING_FIELD_SIZE:4,STATUS_IDLE:"idle",STATUS_PLAYING:"playing",STATUS_WIN:"win",STATUS_LOSE:"lose"}));for(var s=new(n=o),a=!1,i=document.querySelector(".game-score"),c=document.querySelector(".button.start"),u=document.querySelector(".message-start"),l=document.querySelector(".message-win"),I=document.querySelector(".message-lose"),f=e(document.querySelectorAll(".field-cell").values()),L=[],S=0;S<n.const.PLAYING_FIELD_SIZE;S++){L[S]=Array(n.const.PLAYING_FIELD_SIZE);for(var h=0;h<n.const.PLAYING_FIELD_SIZE;h++)L[S][h]=f[S*n.const.PLAYING_FIELD_SIZE+h]}function v(){for(var t=0;t<n.const.PLAYING_FIELD_SIZE;t++)for(var e=0;e<n.const.PLAYING_FIELD_SIZE;e++){for(var r=L[t][e],o=s.getCell(t,e),a=2;a<=2048;a*=2)r.classList.remove("field-cell--".concat(a));0===o?r.textContent="":(r.textContent="".concat(o),r.classList.add("field-cell--".concat(o)))}i.textContent=s.getScore().toString()}L.forEach(function(t,e){t.forEach(function(t,n){t.addEventListener("click",function(){(function(t,e){if(a){var n=s.getCell(t,e);0===n?s.setCell(t,e,2):2048===n?s.setCell(t,e,0):s.setCell(t,e,2*n),v()}})(e,n)})})}),c.addEventListener("click",function(){c.classList.contains("start")&&(c.classList.replace("start","restart"),c.textContent="Restart",u.classList.add("hidden")),l.classList.add("hidden"),I.classList.add("hidden"),s.restart(),s.start(),v()}),document.addEventListener("keydown",function(t){var e=!0;switch(t.key){case"ArrowRight":s.moveRight();break;case"ArrowLeft":s.moveLeft();break;case"ArrowUp":s.moveUp();break;case"ArrowDown":s.moveDown();break;case"F6":a=!a,console.log("debug mode: ".concat(a)),e=!1;break;default:e=!1}if(e){switch(s.getStatus()){case n.const.STATUS_WIN:l.classList.remove("hidden");break;case n.const.STATUS_LOSE:I.classList.remove("hidden")}v()}})}();
//# sourceMappingURL=index.f747f80c.js.map
