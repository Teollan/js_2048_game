var t={};class e{static const=Object.freeze({PLAYING_FIELD_SIZE:4,STATUS_IDLE:"idle",STATUS_PLAYING:"playing",STATUS_WIN:"win",STATUS_LOSE:"lose"});score=0;playingField=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]];initialState=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]];status=e.const.STATUS_IDLE;constructor(t){if(t)for(let s=0;s<e.const.PLAYING_FIELD_SIZE;s++)for(let o=0;o<e.const.PLAYING_FIELD_SIZE;o++)this.initialState[s][o]=t[s][o],this.playingField[s][o]=t[s][o]}moveLeft(){if(this.getStatus()!==e.const.STATUS_PLAYING)return;let t=!0;for(let s=0;s<e.const.PLAYING_FIELD_SIZE;s++){let e=this.getRow(s),o=this.compactLine(e);this.areLinesEqual(e,o.compacted)||(t=!1,this.setRow(s,o.compacted),this.score+=o.score)}t||(this.populateRandomly(1),this.updateStatus())}moveRight(){if(this.getStatus()!==e.const.STATUS_PLAYING)return;let t=!0;for(let s=0;s<e.const.PLAYING_FIELD_SIZE;s++){let e=this.getRow(s),o=this.compactLine(e.reverse());this.areLinesEqual(e,o.compacted)||(t=!1,this.setRow(s,o.compacted.reverse()),this.score+=o.score)}t||(this.populateRandomly(1),this.updateStatus())}moveUp(){if(this.getStatus()!==e.const.STATUS_PLAYING)return;let t=!0;for(let s=0;s<e.const.PLAYING_FIELD_SIZE;s++){let e=this.getColumn(s),o=this.compactLine(e);this.areLinesEqual(e,o.compacted)||(t=!1,this.setColumn(s,o.compacted),this.score+=o.score)}t||(this.populateRandomly(1),this.updateStatus())}moveDown(){if(this.getStatus()!==e.const.STATUS_PLAYING)return;let t=!0;for(let s=0;s<e.const.PLAYING_FIELD_SIZE;s++){let e=this.getColumn(s),o=this.compactLine(e.reverse());this.areLinesEqual(e,o.compacted)||(t=!1,this.setColumn(s,o.compacted.reverse()),this.score+=o.score)}t||(this.populateRandomly(1),this.updateStatus())}getScore(){return this.score}getState(){let t=Array(e.const.PLAYING_FIELD_SIZE);for(let s=0;s<e.const.PLAYING_FIELD_SIZE;s++){t[s]=Array(e.const.PLAYING_FIELD_SIZE);for(let o=0;o<e.const.PLAYING_FIELD_SIZE;o++)t[s][o]=this.playingField[s][o]}return t}getStatus(){return this.status}start(){this.status=e.const.STATUS_PLAYING,this.score=0,this.populateRandomly(2)}restart(){for(let t=0;t<e.const.PLAYING_FIELD_SIZE;t++)for(let s=0;s<e.const.PLAYING_FIELD_SIZE;s++)this.playingField[t][s]=this.initialState[t][s];this.status=e.const.STATUS_IDLE,this.score=0}getColumn(t){let s=Array(e.const.PLAYING_FIELD_SIZE);for(let o=0;o<e.const.PLAYING_FIELD_SIZE;o++)s[o]=this.playingField[o][t];return s}setColumn(t,s){for(let o=0;o<e.const.PLAYING_FIELD_SIZE;o++)this.playingField[o][t]=s[o]}getRow(t){let s=Array(e.const.PLAYING_FIELD_SIZE);for(let o=0;o<e.const.PLAYING_FIELD_SIZE;o++)s[o]=this.playingField[t][o];return s}setRow(t,s){for(let o=0;o<e.const.PLAYING_FIELD_SIZE;o++)this.playingField[t][o]=s[o]}getCells(){return this.playingField.reduce((t,e)=>[...t,...e],[])}getIndexedCells(){return this.getCells().map((t,s)=>{let o=s%e.const.PLAYING_FIELD_SIZE;return{row:(s-o)/e.const.PLAYING_FIELD_SIZE,column:o,value:t}})}getCell(t,e){return this.playingField[t][e]}setCell(t,e,s){this.playingField[t][e]=s}populateRandomly(t){let e=this.getIndexedCells().filter(({value:t})=>0===t);for(let s=0;s<t&&0!==e.length;s++){let t=Math.floor(Math.random()*e.length),{row:s,column:o}=e[t];e.splice(t,1),this.setCell(s,o,this.generateCellValue())}}generateCellValue(){return Math.random()>.9?4:2}compactLine(t){let e=t.filter(t=>0!==t);if(e.length<2)return this.padWithZeros(e),{compacted:e,score:0};let s=[],o=0;for(let t=0;t<e.length;t++){let l=e[t];l===e[t+1]?(s.push(2*l),o+=2*l,t++):s.push(l)}return this.padWithZeros(s),{compacted:s,score:o}}areLinesEqual(t,s){for(let o=0;o<e.const.PLAYING_FIELD_SIZE;o++)if(t[o]!==s[o])return!1;return!0}padWithZeros(t){for(;t.length<e.const.PLAYING_FIELD_SIZE;)t.push(0);return t}updateStatus(){let t=this.getCells();t.some(t=>2048===t)?this.status=e.const.STATUS_WIN:function(t){if(t.some(t=>0===t))return!1;for(let s=0;s<e.const.PLAYING_FIELD_SIZE;s++)for(let o=0;o<e.const.PLAYING_FIELD_SIZE-1;o++)if(t[s*e.const.PLAYING_FIELD_SIZE+o]===t[s*e.const.PLAYING_FIELD_SIZE+(o+1)])return!1;for(let s=0;s<e.const.PLAYING_FIELD_SIZE-1;s++)for(let o=0;o<e.const.PLAYING_FIELD_SIZE;o++)if(t[s*e.const.PLAYING_FIELD_SIZE+o]===t[(s+1)*e.const.PLAYING_FIELD_SIZE+o])return!1;return!0}(t)&&(this.status=e.const.STATUS_LOSE)}}const s=new(t=e);let o=!1;const l=document.querySelector(".game-score"),r=document.querySelector(".button.start"),n=document.querySelector(".message-start"),i=document.querySelector(".message-win"),c=document.querySelector(".message-lose"),a=[...document.querySelectorAll(".field-cell").values()],I=[];for(let e=0;e<t.const.PLAYING_FIELD_SIZE;e++){I[e]=Array(t.const.PLAYING_FIELD_SIZE);for(let s=0;s<t.const.PLAYING_FIELD_SIZE;s++)I[e][s]=a[e*t.const.PLAYING_FIELD_SIZE+s]}function L(){for(let e=0;e<t.const.PLAYING_FIELD_SIZE;e++)for(let o=0;o<t.const.PLAYING_FIELD_SIZE;o++){let t=I[e][o],l=s.getCell(e,o);for(let e=2;e<=2048;e*=2)t.classList.remove(`field-cell--${e}`);0===l?t.textContent="":(t.textContent=`${l}`,t.classList.add(`field-cell--${l}`))}l.textContent=s.getScore().toString()}I.forEach((t,e)=>{t.forEach((t,l)=>{t.addEventListener("click",()=>{(function(t,e){if(o){let o=s.getCell(t,e);0===o?s.setCell(t,e,2):2048===o?s.setCell(t,e,0):s.setCell(t,e,2*o),L()}})(e,l)})})}),r.addEventListener("click",function(){r.classList.contains("start")&&(r.classList.replace("start","restart"),r.textContent="Restart",n.classList.add("hidden")),i.classList.add("hidden"),c.classList.add("hidden"),s.restart(),s.start(),L()}),document.addEventListener("keydown",function(e){let l=!0;switch(e.key){case"ArrowRight":s.moveRight();break;case"ArrowLeft":s.moveLeft();break;case"ArrowUp":s.moveUp();break;case"ArrowDown":s.moveDown();break;case"F6":o=!o,console.log(`debug mode: ${o}`),l=!1;break;default:l=!1}if(l){switch(s.getStatus()){case t.const.STATUS_WIN:i.classList.remove("hidden");break;case t.const.STATUS_LOSE:c.classList.remove("hidden")}L()}});
//# sourceMappingURL=index.e5c48b1d.js.map
